---
title: Configure Microsoft Sentinel MCP Server for AI-powered security investigations
description: Learn how to set up and use the Model Context Protocol (MCP) Server in Microsoft Sentinel to enable natural language queries and AI-powered security investigations through Visual Studio Code.
author: mberdugo
ms.author: monaberdugo
ms.reviewer: mlichtinger
ms.service: microsoft-sentinel
ms.topic: how-to
ms.date: 09/10/2025

#customer intent: As a security analyst, I want to configure Microsoft Sentinel MCP Server so that I can use natural language to query security data and accelerate investigations.
---

# Configure Microsoft Sentinel MCP server for AI-powered security investigations (preview)

This article shows you how to set up and use the Microsoft Sentinel Model Context Protocol (MCP) Server to enable natural language queries against your security data. The MCP Server allows you to interact with Microsoft Sentinel's security data lake using conversational AI through Visual Studio Code and GitHub Copilot.

> [!IMPORTANT]
> Microsoft Sentinel MCP Server is currently in PREVIEW. See the [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/) for legal terms that apply to Azure features that are in beta, preview, or otherwise not yet released into general availability.

## What is the Model Context Protocol?

The [Model Context Protocol (MCP)](https://modelcontextprotocol.io/docs/getting-started/intro) is an open, client-server protocol that standardizes how AI agents discover and use external data and capabilities.

- **MCP Server**: Exposes security data and context as semantically accessible tools with natural language inputs/outputs
- **MCP Client**: Connects to the server through agent frameworks or IDE extensions to discover and invoke available tools

This integration eliminates the need for bespoke API integrations, reduces errors and improves accuracy through strongly typed schemas, and makes tool discovery predictable across any agent runtime.

## Prerequisites

Before you begin, make sure you have:

- A Microsoft Sentinel workspace with data ingested
- An Azure account with at least **Security Reader** role for using tools, or **Security Operator** role for creating custom tools
- [Visual Studio Code](https://code.visualstudio.com/) installed
- [GitHub Copilot](https://github.com/features/copilot) enabled in Visual Studio Code
- [Azure CLI](/cli/azure/install-azure-cli) installed (for custom tool development)

## Collections and tools

In the context of MCP, a tool is a discrete capability exposed by the MCP server, often representing a query or data extraction operation. Tools are described with rich metadata and accept natural language inputs.

A collection is a logical grouping of related MCP tools. Collections help organize tools based on functionality or data source.

The MCP Server provides these built-in tools in the root (`/`) collection:

| Tool | Description |
|------|-------------|
| **Table Search** | Find tables relevant to natural language queries and get plain-language descriptions of their schemas |
| **Run KQL** | Execute KQL queries on the Microsoft Sentinel data lake to retrieve and analyze security data |

## Configure MCP Server in Visual Studio Code

Follow these steps to integrate the MCP Server with Visual Studio Code:

### Step 1: Add the MCP Server

1. Open Visual Studio Code.
1. Press **Ctrl+Shift+P** to open the command palette
1. Type `MCP: Add server`
1. Choose **HTTP (HTTP or Server-Sent Events)**
1. When prompted, enter the server URL
1. Assign a friendly Server ID, such as "Sentinel MCP Server"
1. Choose whether to make the server available in all VS Code workspaces or just the current one.

### Step 2: Authenticate

1. When prompted, select **Allow**.
1. Sign in with an account that has at least **Security Reader** role on your Microsoft Sentinel workspace.

### Step 3: Verify the connection

1. Open VS Code's chat panel: **View** > **Chat**, or press **Ctrl+Alt+I**
1. Set chat to **Agent** mode.
1. Enter the prompt: "What MCP Tools are available?"
1. Verify that you see the available tools listed

### Step 4: Use natural language queries

You can now interact with your security data using natural language. The results are generated by the LLM model you chose in GitHub Copilot chat. For example:

- "Search for tables containing authentication data"
- "Run a KQL query to find failed sign-in attempts in the last 24 hours"
- "Show me security events from Windows devices"

> [!TIP]
> The AI generates KQL queries based on your natural language prompts. Always review generated queries for accuracy before using them in production investigations.

## Create custom tools using the API

You can extend the MCP Server's capabilities by creating custom tools tailored to your security workflows.

### Obtain a bearer token

1. Open PowerShell or Azure Cloud Shell.
1. Run the following commands:
  
    ```powershell
    az login --tenant <your-tenant-id>
    az account get-access-token --scope https://securityplatform.microsoft.com/.default  --query accessToken -o tsv | clip
    ```
  
1. The bearer token is now in your clipboard. Store it securely as you would a password.

### Create a collection and tools

You can use [Insomnia](https://developer.konghq.com/insomnia/) (recommended) or any REST client to create custom tools.

#### [Using Insomnia](#tab/insomnia)

1. Download and install [Insomnia](https://insomnia.rest/download).
1. Import the following Insomnia Collection YAML file:  (Bug_Bash.yaml).
1. Create or update a collection using the appropriate endpoints. Verify successful completion using the *List All Collections* or *Get Collection* endpoints.
1. Create or update tools within the collection. Verify their creation with the *List All Tools in a Collection* or *Get Tool* endpoints.
1. Add Newly created Collection to GitHub Copilot: Integrate the newly created collection and tools as an MCP Server in Visual Studio Code, following previously outlined [steps](#step-1-add-the-mcp-server). Use the endpoint `https://westus2.api.securityplatform.microsoft.com/mcp/CollectionName` for configuration.
1. Clean up: (optional) Remove any unused collections or tools. Always delete tools before deleting their parent collection.

#### [Using REST client](#tab/rest-client)

Use the base URL: [URL]> with the following headers:

- Authorization: Bearer token
- Content-Type: application/json

Collection Endpoints:

- List Collections: GET /aiprimitives/mcpToolCollections/
- Create/Update Collection: PUT /aiprimitives/mcpToolCollections/
- Body template: { "name": "CollectionName"}
- Get Collection: GET /aiprimitives/mcpToolCollections/
- Delete Collection: DELETE /aiprimitives/mcpToolCollections/ 

Tool Endpoints:

- List Tools: GET /aiprimitives/mcpToolCollections//tools
- Create Tool: PUT /aiprimitives/mcpToolCollections//mcpTools/
- Body template: 

  ```json
    { "name": "Tool Name", "title": "Get CVE From TVM", "collectionName": "Collection Name", "mcpToolType": "Kqs", "description": "Retrieve CVE information and affected software from Defender for Cloud vulnerability data (substitute for TVM).", "properties": { "mcpToolType": "Kqs", "arguments": { "type": "object", "properties": { "CVE-ID": { "type": "string", "description": "CVE ID (e.g., 'CVE-2025-38382')" }, "database": { "type": "string", "description": "Database name (Sentinel-connected Log Analytics workspace)" } }, "required": ["CVE-ID", "database"] }, "queryFormat": "let CveParam = tolower(tostring('{CVE-ID}')); SecurityNestedRecommendation | where tostring(VulnerabilityId) != '' or tostring(AdditionalData) contains 'cve' | extend CveId = iif(tostring(VulnerabilityId) != '', VulnerabilityId, tostring(extract(@'\"CVE\"\\s*:\\s*\"(CVE-[0-9-]+)\"', 1, tostring(AdditionalData)))) | where tolower(CveId) == CveParam | summarize LatestPublished = max(TimeGenerated), VulnerabilitySeverityLevel = any(RecommendationSeverity), AffectedSoftware = make_set(tostring(AdditionalData.softwareDetails.packageName), 50), Title = any(RecommendationName) | project CveId = tostring('{CVE-ID}'), PublishedDate = LatestPublished, CvssScore = real(null), VulnerabilitySeverityLevel, VulnerabilityDescription = Title, AffectedSoftware" }}
  ```

- Get Tool: GET /aiprimitives/mcpToolCollections//mcpTools/
- Delete Tool: DELETE /aiprimitives/mcpToolCollections//mcpTools/

Once your collection and tools are created, integrate them into Visual Studio Code by adding the collection endpoint ([URL]) as an MCP server.

---

## Best Practices

- Security: Use accounts with minimum required permissions. Use Security Reader for accessing tools and Security Operator only when creating custom tools.
- Token management: Regenerate bearer tokens every hour and store them securely.
- Tool organization: Group related tools in logical collections to simplify discovery and management.
- Testing: Verify tool functionality in VS Code after making changes.
- Query validation: Always review AI-generated KQL queries before executing them.

## Limitations

Currently, there's no graphical interface to manage tools. Tools and collections are managed via API or REST clients.
