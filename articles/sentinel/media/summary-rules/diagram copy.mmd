---
config:
  look: neo
  theme: default
---
sequenceDiagram
  actor User as User
  participant Azure AD as Azure AD
  participant Azure Monitor as Azure Monitor
  participant Log Analytics Workspace as Log Analytics Workspace
  participant VM as VM
  User ->> Azure AD: 1. Register Microsoft Entra application
  Azure AD ->> User: Provide Application ID and secret
  User ->> Azure AD: 2. Assign the Monitoring Metrics Publisher role to the application
  User ->> Azure Monitor: 3. Deploy ARM template to create a DCE, DCR, and CommonSecurityLog_CL Auxiliary table
  Azure Monitor ->> User: Provide DCE URI and DCR Immutable ID
  User ->> VM: 4. Update Logstash configuration file
  VM ->> Azure Monitor: Send data to DCE
  Azure Monitor ->> Log Analytics Workspace: Ingest raw data into CommonSecurityLog_CL table
  User ->> Azure Monitor: 5. Create summary rule
  VM ->> Azure Monitor: Send data to DCE
  Azure Monitor ->> Log Analytics Workspace: Ingest raw data into CommonSecurityLog_CL table
  Azure Monitor ->> Log Analytics Workspace: Ingest aggregated data into a new custom table
