---
title: 'Troubleshooting of site-to-site with digital certificate authentication'
Learn how to troubleshoot Azure Site-to-Site VPN Gateway connections that use digital certificate authentication. Resolve error codes, fix connectivity problems, and ensure stable VPN operations.
titleSuffix: Azure VPN Gateway
author: duongau
ms.service: azure-vpn-gateway
service: Azure VPN Gateway
ms.topic: troubleshooting
ms.date: 08/11/2025
ms.author: duau
# Customer intent: As a network administrator, I want to troubleshoot Azure Site-to-Site VPN connection issues, so that I can ensure stable connectivity and minimize disruptions for users.
---

# Troubleshooting of site-to-site with digital certificate authentication

This article helps you troubleshoot Azure Site-to-Site VPN Gateway connections that use digital certificate authentication. It lists common error codes, explains their causes, and provides recommended actions to resolve connectivity issues. Use this guide to maintain stable VPN operations and minimize disruptions for users.

| ErrorCode | Error message | Action |
|-----------|---------------|--------|
| CannotSetConnectionAuthenticationForExpressRouteConnectionType | ConnectionAuthentication can't be configured for connection {0} because its type is ExpressRoute. For more information, see: https://go.microsoft.com/fwlink/?linkid=2208263 | ConnectionAuthentication is only supported for VPN Gateway connections, not ExpressRoute. |
| VpnGatewayKeyVaultTokenRequestParameterMissingError | Missing required parameter for requesting user's Key Vault access token for VPN Gateway {0}. | The Network Resource Provider (NRP) didn't receive necessary managed identity properties from Azure Resource Manager. To resolve this issue, open an Azure support ticket for assistance. |
| ManagedIdentityMissingAtGatewayLevel | User assigned managed identity is required at gateway {0} to use PSK/Certificate from customer&apos;s keyvault in connection {1}. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208456 and https://go.microsoft.com/fwlink/?linkid=2208263 | User has to add userAssigned managed identity in the gateway. |
| MaxRootCertificatePublicKeySupported | A maximum of {0} root and intermediate certificate public keys ({1}) are supported. For more information, see: https://go.microsoft.com/fwlink/?linkid=2208263. | The certificate chain provided exceeds the supported length. Azure currently supports certificate chains (root + intermediate) up to a length of 5. |
| VpnGatewayConnectionAuthenticationUsingCertInCustomerKeyvaultIsNotEnabled | VPN Gateway certificate-based connection authentication isn't enabled for gateway {0}. | Digital certificate authentication isn't enabled for the Azure subscription. To resolve this issue, open an Azure support ticket for assistance. |
| VpnGatewayManagedIdentitySupportIsNotEnabled | Managed identity support isn't enabled for VPN gateway {0}. | You attempted to add a managed identity to the VPN gateway, but digital certificate authentication isn't enabled for your Azure subscription. To resolve this issue, open an Azure support ticket for assistance. |
| VpnGatewayManagedIdentity | Managed identity is supported for VPN Gateway SKUs of VpnGw1 or higher. For more information, see: https://go.microsoft.com/fwlink/?linkid=2208456 | To use managed identity, ensure your VPN Gateway is sized VpnGw1 or greater. |
| VpnGatewayConnectionAuthenticationUsingPskInCustomerKeyvaultIsNotEnabled | VPN Gateway connection authentication using a preshared key stored in Key Vault isn't enabled for gateway {0}. | Preshared key authentication from your Key Vault isn't enabled for your Azure subscription. To enable this feature, open an Azure support ticket for assistance. |
| VpnConnectionAuthenticationRootCertificateDataInvalid | Root/Intermediate certificate public key for certificate authentication is invalid. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Root certificate isn't valid. |
| VpnConnectionAuthenticationRootCertificateDataInvalidBecausePrivateKey | Root/Intermediate certificate public key for certificate authentication is invalid because it has private key. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Root certificate has a private key, which isn't supported. |
| VpnConnectionAuthenticationDuplicateRootCertificate | Root/Intermediate certificate public key for certificate authentication has duplicate entry. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | User has added two root certificates. Remove one and retry. |
| VpnConnectionAuthenticationCertChainCreationIssue | Exception thrown while building chain for Root/Intermediate certificate with thumbprint: {0} for certificate authentication. Exception details: {1}. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Exception message has data about why cert creation failed. |
| VpnConnectionAuthenticationRootCertificateIsExpired | Certificate authentication inbound root certificate is expired. Add a new certificate and retry. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Replace the expired root certificate with a valid one and retry the connection. |
| VpnConnectionOutBoundAuthenticationCertificateIsExpired | Certificate authentication outbound certificate is expired. Add a new certificate and retry. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Update the outbound certificate with a valid, nonexpired certificate and retry the connection. |
| VpnConnectionOutBoundAuthenticationCertificateIsEmpty | Certificate authentication outbound certificate is empty. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | VPN Gateway couldn't fetch certificate from keyvault. |
| VpnConnectionOutBoundAuthenticationCertificateDoesNotHaveRSAPrivateKey | Certificate authentication outbound certificate isn't having RSA private key. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Outbound certificate is missing RSA private key. |
| VpnConnectionOutBoundAuthenticationCertificateRSAPrivateKeyLength | Certificate authentication outbound certificate RSA private key length should be atleast {0}. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Outbound certificate private key length isn't sufficient. |
| VpnConnectionOutBoundAuthenticationCertificateChainCreationIssue | Issue in creating certificate chain for Certificate authentication outbound certificate. Exception details {0}. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Error message is self-explanatory |
| VpnConnectionOutBoundAuthenticationCertificateChainFault | Certificate authentication outbound certificate chain should have atleast {0} certificate in it but has only {1} certificate. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | The outbound certificate provided by customer doesn't have certificate chain. |
| VpnConnectionInBoundAuthenticationCertificateChainFault | Certificate authentication inbound certificate chain is empty. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Couldn't able to make certificate chain with root and intermediate cert. |
| VpnConnectionOutBoundAuthenticationCertificateChainDoesNotHaveRootCert | Certificate authentication outbound certificate chain doesn't have root cert. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Error code is self-explanatory |
| VpnConnectionInBoundAuthenticationCertificateChainDoesNotHaveRootCert | Certificate authentication Inbound certificate chain doesn't have root cert. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Error message is self-explanatory |
| VpnConnectionInBoundAuthenticationCertificateChainDoesNotHaveAllGivenCerts | All certificate provided for Certificate authentication Inbound certificate chain doesn't belongs to single certificate chain. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Error message is self-explanatory |
| VpnConnectionOutBoundAuthenticationCertificateClientAndServerAuth | Certificate authentication outbound certificate should have both client and server authentication in Enhanced Key Usage extension. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Outbound certificate is missing Client and server authentication in EnhancedKey usage extension. https://oidref.com/1.3.6.1.5.5.7.3.2 |
| ConnectionAuthenticationPSKAmbiguity | There's an ambiguity with preshared key. Both SharedKey and SharedKeyKeyvaultId are present in connection object. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Error message is self-explanatory |
| InvalidCertificateAuthenticationObject | CertificateAuthentication should be null when AuthenticationType is preshared key. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | It means user has opted to use preshared key based connection authentication but also filling CertificateAuthentication object. |
| CertificateAuthenticationObjectIsEmpty | CertificateAuthentication shouldn't be null when AuthenticationType is Certificate. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | It means customer has opted out for certificate based connection authentication but also not filling CertificateAuthentication object. |
| InvalidPskExist | SharedKey/SharedKeyKeyvaultId should be empty when AuthenticationType is Certificate. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Error message is self-explanatory |
| CertificateSubjectNameIsEmpty | InboundAuthCertificateSubjectName in CertificateAuthentication shouldn't be empty when AuthenticationType is Certificate. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Error message is self-explanatory |
| InboundAuthCertificateChainIsEmpty | InboundAuthCertificateChain in CertificateAuthentication shouldn't be empty when AuthenticationType is Certificate. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Error message is self-explanatory |
| OutboundAuthCertificateIsEmpty | OutboundAuthCertificate in CertificateAuthentication shouldn't be empty when AuthenticationType is Certificate. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Error message is self-explanatory |
| VpnGatewayKeyVaultTokenRequestError | KeyVault access token request failed for Vpn Gateway '{0}'. | VPN has failure in accessing customer keyvault. Open an Azure support ticket to receive assistance |
| VpnGatewayKeyVaultSecretException | Problem occurred while accessing and validating KeyVault Secrets associated with resource type {0} (ID &apos;{1}&apos;). See details below: | VPN has failure in accessing customer keyvault. Open an Azure support ticket to receive assistance |
| VpnGatewayKeyVaultSecretNotFound | KeyVault Secret '{0}' couldn't be found for resource type {1} (ID '{2}'). | Couldn't found Secret/certificate in keyvault. |
| VpnGatewayKeyVaultSecretAccessDenied | Access denied for KeyVault Secret '{0}' for resource type {1} (ID '{2}'). Make sure that Identity assigned to Vpn Gateway has access to the  KeyVault associated with secret and KeyVault has *Allow trusted Microsoft services to bypass this firewall* set to *yes*. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208456 | Error message is self-explanatory |
| VpnGatewayKeyVaultRequestTimeout | KeyVault Request Timeout occurred while waiting for '{0}' for resource type {1} (ID '{2}'). | VPN request timed out when accessing keyvault. Retry, if that doesn't work open an Azure support ticket to receive assistance |
| VpnGatewayKeyVaultNameResolutionFailure | KeyVault host url '{0}' can't be resolved for resource type {1} (ID '{2}'). | Check if right outbound certificate url/path is passed in CertificateAuthentication object. |
| VpnGatewayKeyVaultSecretIsEmpty | Secret stored in keyvault with secretId '{0}' is empty for resource type {1} (ID '{2}'). | Error message is self-explanatory |
| VpnGatewayKeyVaultCertIsEmpty | Certificate stored in keyvault with certificate '{0}' is empty for resource type {1} (ID '{2}'). Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208456 | Error message is self-explanatory |
| PlainTextSharedKeyDoesnotExistCertIsGettingUsedForAuthentication | Invalid operation. Plain text shared key doesn't exist. ConnectionAuthentication with authentication type Certificate is getting used in connection {0}. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | The exception occurs when customer is trying to get shared key, but they're using certificate for connection authentication. |
| PlainTextSharedKeyDoesnotExistSharedKeyStoredInKeyvaultIsGettingUsedForAuthentication | Invalid operation. Plain text shared key doesn't exist. Shared key stored in keyvault is getting used in connection {0}. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | The exception occurs when customer is trying to get shared key but they're using PSK in keyvault for connection authentication. |
| ResetSharedKeyIsNotSupportedBecauseNonPlainTextSharedKeyIsGettingUsedForConnectionAuthentication | Not supported operation. ConnectionAuthentication with non plain text shared key has been used in connection {0}. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208263 | Error message is self-explanatory |
| CannotDeleteManagedIdentity | Can't delete Identity. It's getting used by connection {0} to access keyvault secret {1}. | Customer is trying to delete managed identity from gateway but connection is using it for connection authentication with certificate/PSK from keyvault. |
| VpnGatewaySupportsUserAssignedIdentityTypeOnly | Only UserAssigned identity type is supported for Vpn Gateway '{0}'. Provided identify type is {1}. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208456 | Error message is self-explanatory |
| VpnGatewayAllowsOneUserAssignedIdentityOnly | Only one UserAssigned identity is allowed for Vpn Gateway '{0}'. Follow the link for more details: https://go.microsoft.com/fwlink/?linkid=2208456 | Error message is self-explanatory |

## Next steps

